# BMAD Auto-Sync System

This project now has **automated BMAD status synchronization** configured! ğŸ‰

## How It Works

The BMAD status system automatically syncs in **3 ways**:

### 1. Git Pre-Commit Hook âœ… ACTIVE
**Trigger**: Every time you run `git commit`

**What it does**:
- Runs `npm run bmad:sync` before the commit
- Updates `docs/BMAD_STATUS.md` with latest story progress
- Updates story frontmatter with `last_sync` timestamps
- Auto-stages the updated files

**Location**: `.git/hooks/pre-commit`

**To disable temporarily**:
```bash
git commit --no-verify  # Skip the hook for one commit
```

---

### 2. GitHub Actions âœ… CONFIGURED
**Trigger**: Push to `main` branch when story files change

**What it does**:
- Runs `npm run bmad:sync` in CI environment
- Commits the updated status dashboard back to the repo
- Uses BMAD Bot identity for commits

**Location**: `.github/workflows/bmad-sync.yml`

**âš ï¸ Requires Secrets**: You need to add these to GitHub repo settings:
- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`

**To add secrets**:
1. Go to: GitHub Repo â†’ Settings â†’ Secrets and variables â†’ Actions
2. Add both secrets with values from your `.env.local`

---

### 3. Development File Watcher (Optional)
**Trigger**: Manual - run when actively editing stories

**What it does**:
- Watches `docs/stories/*.md` for changes
- Auto-runs `npm run bmad:sync` on every save
- Useful during active story writing sessions

**To start**:
```bash
npm run bmad:watch
```

**To stop**: Press `Ctrl+C`

---

## Quick Reference Commands

```bash
# Manual sync (always available)
npm run bmad:sync          # Sync all stories + generate dashboard

# Development mode (auto-sync on file changes)
npm run bmad:watch         # Watch mode - syncs on every save

# Validation & troubleshooting
npm run bmad:status        # Check for drift between files and DB
npm run bmad:validate      # Same as above
npm run bmad:fix           # Fix story status inconsistencies
```

---

## What Gets Synced

From **story markdown files** (`docs/stories/epic-*.md`):
- âœ… Story metadata (epic, story number, status, progress)
- âœ… Acceptance Criteria checkboxes `- [x] **AC1**: ...`
- âœ… Integration Verifications `- [x] **IV1**: ...`
- âœ… Migration Checkpoints `- [x] **MC1**: ...`

To **Supabase database**:
- âœ… Tables: `epics`, `stories`, `acceptance_criteria`, `integration_verifications`, `migration_checkpoints`

To **status dashboard**:
- âœ… `docs/BMAD_STATUS.md` (auto-generated, do not edit manually)

---

## Disabling Auto-Sync

### For a specific story file:
Add to frontmatter:
```yaml
---
auto_sync: false
---
```

### For pre-commit hook:
```bash
# Temporarily (one commit)
git commit --no-verify

# Permanently
rm .git/hooks/pre-commit
```

### For GitHub Actions:
Delete or rename `.github/workflows/bmad-sync.yml`

---

## Troubleshooting

**Pre-commit hook not running?**
```bash
# Check if it's executable
ls -l .git/hooks/pre-commit
# Make it executable if needed
chmod +x .git/hooks/pre-commit
```

**GitHub Actions failing?**
- Check that secrets are set correctly
- View logs in: GitHub Repo â†’ Actions tab
- Make sure Supabase credentials are valid

**Sync errors?**
```bash
# Check for drift/conflicts
npm run bmad:validate

# Fix story status issues
npm run bmad:fix

# Manual sync to see detailed output
npm run bmad:sync
```

---

## Architecture

```
Story Files                    Supabase Database
  (markdown)                   (PostgreSQL)
      â”‚                              â”‚
      â”‚                              â”‚
      â”œâ”€â”€â”€â”€ bmad:sync â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚     (bi-directional)         â”‚
      â”‚                              â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        BMAD_STATUS.md
        (auto-generated
         dashboard)
```

**Sync Triggers**:
1. Git pre-commit hook (local)
2. GitHub Actions (CI/CD)
3. File watcher (development)
4. Manual command (anytime)

---

**Last Updated**: 2025-11-20
**Auto-Sync Status**: âœ… Active (pre-commit + GitHub Actions)
