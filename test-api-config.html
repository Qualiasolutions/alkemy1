<!DOCTYPE html>
<html>
<head>
    <title>API Configuration Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        pre { background: #000; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Alkemy AI Studio - API Configuration Test</h1>
    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            results.appendChild(div);
        }

        // Test 1: Check process.env exposure
        log('=== Testing Environment Variables ===');
        log(`process.env.GEMINI_API_KEY: ${process.env.GEMINI_API_KEY ? '✓ Present (length: ' + process.env.GEMINI_API_KEY.length + ')' : '✗ Missing'}`,
            process.env.GEMINI_API_KEY ? 'success' : 'error');
        log(`process.env.FLUX_API_KEY: ${process.env.FLUX_API_KEY ? '✓ Present' : '✗ Missing'}`,
            process.env.FLUX_API_KEY ? 'success' : 'warning');
        log(`process.env.FORCE_DEMO_MODE: ${process.env.FORCE_DEMO_MODE || 'false'}`,
            process.env.FORCE_DEMO_MODE === 'false' || !process.env.FORCE_DEMO_MODE ? 'success' : 'error');
        log(`process.env.USE_FALLBACK_MODE: ${process.env.USE_FALLBACK_MODE || 'false'}`,
            process.env.USE_FALLBACK_MODE === 'false' || !process.env.USE_FALLBACK_MODE ? 'success' : 'error');

        log('\n=== Testing import.meta.env exposure ===');
        log(`import.meta.env.VITE_GEMINI_API_KEY: ${import.meta.env.VITE_GEMINI_API_KEY ? '✓ Present' : '✗ Missing'}`,
            import.meta.env.VITE_GEMINI_API_KEY ? 'success' : 'warning');
        log(`import.meta.env.VITE_FORCE_DEMO_MODE: ${import.meta.env.VITE_FORCE_DEMO_MODE || 'false'}`,
            import.meta.env.VITE_FORCE_DEMO_MODE === 'false' || !import.meta.env.VITE_FORCE_DEMO_MODE ? 'success' : 'error');

        // Test 2: Import and check API service
        log('\n=== Testing AI Service Module ===');
        try {
            const { getGeminiApiKey } = await import('./services/apiKeys.js');
            const apiKey = getGeminiApiKey();
            log(`getGeminiApiKey() returns: ${apiKey ? '✓ API Key found (length: ' + apiKey.length + ')' : '✗ No API Key'}`,
                apiKey ? 'success' : 'error');
        } catch (error) {
            log(`Error importing apiKeys: ${error.message}`, 'error');
        }

        log('\n=== Final Verdict ===');
        const hasKey = process.env.GEMINI_API_KEY?.length > 0;
        const demoMode = process.env.FORCE_DEMO_MODE === 'true' || process.env.USE_FALLBACK_MODE === 'true';

        if (hasKey && !demoMode) {
            log('✓ Configuration is correct - AI generation should work!', 'success');
        } else if (!hasKey) {
            log('✗ GEMINI_API_KEY is missing - Please check .env.local', 'error');
        } else if (demoMode) {
            log('✗ Demo mode is ENABLED - Placeholder images will be generated', 'error');
        }

        log('\n=== Instructions ===');
        log('1. Open browser console (F12) to see [API Keys] and [AI Service] debug logs');
        log('2. Go to Cast & Locations tab and try generating a character image');
        log('3. Check network tab for requests to generativelanguage.googleapis.com');
        log('4. If you see Unsplash URLs, demo mode is still active');
    </script>
</body>
</html>
